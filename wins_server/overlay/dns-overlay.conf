# DNS SERVER OVERLAY


# --- DNS Event Groups (named lists of Event IDs) ---
# Record changes: new/deleted DNS records (high value)
define DNSRecordChanges 515, 516

# Zone operations: zone reloads and successful zone transfers
define DNSZoneOperations 561, 6001

# Optional noisy protocol junk (do NOT enable unless you want it)
# define DNSProtocolNoise 5502, 5504


<Input in_dns_role>
  Module              im_msvistalog
  ResolveSID          TRUE
  ResolveGUID         TRUE
  Language            en-US
  TolerateQueryErrors FALSE

  <QueryXML>
    <QueryList>
      <Query Id="0">
        <!-- Core DNS Server log -->
        <Select Path="DNS Server">*</Select>

        <!-- DNS Audit channel (record create/delete often appears here too) -->
        <Select Path="Microsoft-Windows-DNSServer/Audit">*</Select>

        <!-- Optional: DNS client operational (usually NOT needed on DNS servers) -->
        <!-- <Select Path="Microsoft-Windows-DNS-Client/Operational">*</Select> -->
      </Query>
    </QueryList>
  </QueryXML>

  # Keep only the high-value DNS events (drop the rest)
  <Exec>
    if (
      ($EventID NOT IN (%DNSRecordChanges%)) and
      ($EventID NOT IN (%DNSZoneOperations%))
    ) {
      drop();
    }
  </Exec>
</Input>
